---
# Talos bootstrap settings
talos_config_dir: "{{ playbook_dir }}/talos-configs"
talos_config_file: "{{ talos_config_dir }}/talosconfig"
kubeconfig_file: "{{ playbook_dir }}/kubeconfig-talos.yaml"

# Determine the first master node for bootstrap
bootstrap_node: "{{ groups['talos_masters'][0] }}"
bootstrap_ip: "{{ hostvars[bootstrap_node].ansible_host }}"

# Cilium settings
cilium_version: "1.17.4"
cilium_namespace: "kube-system"
cilium_repo_url: "https://helm.cilium.io"

# LoadBalancer IP pool
load_balancer_ip_pool:
  - "192.168.0.224/27"

# Cilium values (matches live cluster state)
cilium_values:
  k8sServiceHost: 192.168.0.100
  k8sServicePort: "6443"
  operator:
    replicas: 1
  kubeProxyReplacement: true
  waitForKubeProxy: false
  l2announcements:
    enabled: true
  ipam:
    mode: kubernetes
  hubble:
    enabled: false
    relay:
      enabled: false
    ui:
      enabled: false
  tolerations:
    - key: node-role.kubernetes.io/control-plane
      effect: NoSchedule
    - key: node.kubernetes.io/not-ready
      effect: NoSchedule
      operator: Exists
    - key: node.cilium.io/agent-not-ready
      effect: NoSchedule
      operator: Exists
  # Talos-specific settings
  securityContext:
    capabilities:
      ciliumAgent:
        - CHOWN
        - KILL
        - NET_ADMIN
        - NET_RAW
        - IPC_LOCK
        - SYS_ADMIN
        - SYS_RESOURCE
        - DAC_OVERRIDE
        - FOWNER
        - SETGID
        - SETUID
      cleanCiliumState:
        - NET_ADMIN
        - SYS_ADMIN
        - SYS_RESOURCE
  cgroup:
    autoMount:
      enabled: false
    hostRoot: /sys/fs/cgroup
