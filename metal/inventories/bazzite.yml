---
all:
  vars:
    proxmox_api_host: "{{ lookup('env', 'PROXMOX_HOST') | default('192.168.0.2') }}"
    proxmox_user: "{{ lookup('env', 'PROXMOX_USER') | default('root@pam') }}"
    proxmox_token_id: "{{ lookup('env', 'PROXMOX_TOKEN_ID') | default('') }}"
    proxmox_token_secret: "{{ lookup('env', 'PROXMOX_TOKEN_SECRET') | default('') }}"

bazzite_vms:
  hosts:
    bazzite-erebor:
      # SSH connection
      ansible_host: 192.168.0.15
      ansible_user: bazzite
      ansible_become: true

      # Proxmox node
      proxmox_node: erebor
      proxmox_host: 192.168.0.101

      # VM specs
      vm_id: 120
      vm_name: bazzite
      cpu: 4
      memory: 10240  # 10GB — leaves 4GB for K8s worker + Proxmox
      disk_size: 128  # GB
      vm_storage: local-lvm
      vm_network_bridge: vmbr0  # erebor uses vmbr0 for LAN

      # NVIDIA GTX 1660 Ti passthrough (matches proxmox.yml erebor config)
      gpu_pci_address: "01:00"
      gpu_passthrough_ids: "10de:2182,10de:1aeb,10de:1aec,10de:1aed"

      # USB passthrough to VM (port-based for external, device-ID for internal)
      # Intel Cannon Lake xHCI: Bus 1 = USB 2.0, Bus 2 = USB 3.0
      # USB 3.0 physical ports need BOTH bus entries (1-N + 2-N) for full speed
      # Port 1-1 / 2-1 reserved for host (2.5G Ethernet — needs USB 3.0 bandwidth)
      # Port 1-10 (ASUS ITE) is internal motherboard, stays on host
      usb_passthrough_devices:
        # USB 3.0 ports — use for hard drives, fast peripherals
        - port: "1-3"              # Port B — USB 2.0 side
        - port: "2-3"              # Port B — USB 3.0 side
        - port: "1-5"              # Port E — USB 2.0 side
        - port: "2-5"              # Port E — USB 3.0 side
        - port: "1-6"              # Port D — USB 2.0 side
        - port: "2-6"              # Port D — USB 3.0 side
        # USB 2.0 only ports — fine for mice, keyboards, Xbox adapter, controllers
        - port: "1-8"              # Port A — USB 2.0 only (no USB 3.0 companion)
        - port: "1-9"              # Port C — USB 2.0 only (no USB 3.0 companion)
        # Internal devices (by device ID, not port)
        - id: "8087:0aaa"          # Intel Bluetooth 9460/9560 (internal header)

      # Fedora Kinoite ISO (base install, then rebase to Bazzite)
      base_iso: "Fedora-Kinoite-ostree-x86_64-42-1.1.iso"
      base_iso_url: "https://dl.fedoraproject.org/pub/fedora/linux/releases/42/Kinoite/x86_64/iso/Fedora-Kinoite-ostree-x86_64-42-1.1.iso"
      iso_storage: local
